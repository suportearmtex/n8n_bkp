{"createdAt":"2025-06-08T19:49:49.541Z","updatedAt":"2025-06-08T19:57:56.804Z","id":"ptGqXpKib5XGh55Y","name":"[bck]","active":false,"isArchived":true,"nodes":[{"parameters":{"options":{}},"id":"2bd205d1-68ec-4d27-95ca-5a2c465c07ab","name":"Set date","type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-1480,380]},{"parameters":{"operation":"formatDate","date":"={{ $json.currentDate }}","format":"custom","customFormat":"dd-MM-yyyy/H:mm","options":{}},"id":"a61a1e09-4fb1-407f-ae50-26e1c02b0983","name":"Format date","type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-1280,380]},{"parameters":{"keepOnlySet":true,"values":{"string":[{"name":"commitDate","value":"={{ $json.formattedDate }}"}]},"options":{}},"id":"47e08eaa-fc75-4c36-acc6-ad2f4b63fbf3","name":"Set commit date","type":"n8n-nodes-base.set","typeVersion":2,"position":[-1080,380]},{"parameters":{"resource":"file","operation":"list","owner":{"__rl":true,"value":"=url_do_github","mode":"url"},"repository":{"__rl":true,"value":"n8n_bkp","mode":"list","cachedResultName":"n8n_bkp","cachedResultUrl":"https://github.com/suportearmtex/n8n_bkp"},"filePath":"="},"id":"6384cb3d-4113-4073-b1dc-c3804f74fe4b","name":"List files from repository [GITHUB]","type":"n8n-nodes-base.github","typeVersion":1,"position":[-880,380],"alwaysOutputData":true,"webhookId":"fc12b7ad-e125-440e-8541-ee4a4cc2026b"},{"parameters":{"operation":"aggregateItems","fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"name"}]},"options":{}},"id":"dde0c72e-01fd-496e-9846-e61a80865fb3","name":"Combine file names [GITHUB]","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[-680,380]},{"parameters":{"filters":{},"requestOptions":{}},"id":"20749196-e3b2-4d5f-bad8-4cf045eba142","name":"Retrieve workflows [N8N]","type":"n8n-nodes-base.n8n","typeVersion":1,"position":[-480,380]},{"parameters":{"mode":"jsonToBinary","options":{"fileName":"={{ $json.name.replace(/\\s+/g, '-').toLowerCase() }}-{{ $json.id }}.json"}},"id":"d6621fa9-14bd-4f58-a11d-032a87d88c4a","name":"Move JSON to binary","type":"n8n-nodes-base.moveBinaryData","typeVersion":1,"position":[-280,380]},{"parameters":{"batchSize":1,"options":{}},"id":"10277241-c1ef-4059-86d2-df705f4dc72b","name":"Split to single items","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[-40,380]},{"parameters":{"conditions":{"string":[{"value1":"={{ $node['Combine file names [GITHUB]'].json.name }}","operation":"contains","value2":"={{ $binary.data.fileName }}"}]}},"id":"7d461184-f55e-469a-8b8e-3a58c080d9d6","name":"Check if file exists in repository","type":"n8n-nodes-base.if","typeVersion":1,"position":[200,300]},{"parameters":{"resource":"file","operation":"edit","owner":{"__rl":true,"value":"url_do_github","mode":"url"},"repository":{"__rl":true,"value":"n8n_bkp","mode":"list","cachedResultName":"n8n_bkp","cachedResultUrl":"https://github.com/armtexIA/n8n_bkp"},"filePath":"={{ $binary.data.fileName }}","binaryData":true,"commitMessage":"=backup-{{ $node['Set commit date'].json.commitDate }}"},"id":"487107ef-e99b-4f02-9a20-554875ecbe7a","name":"Update file [GITHUB]","type":"n8n-nodes-base.github","typeVersion":1,"position":[420,100],"webhookId":"4a490d1b-4070-48ed-ac5d-01e2e19a9967","credentials":{"githubApi":{"id":"EN8RdrPthxo5wicx","name":"GitHub account"}}},{"parameters":{"resource":"file","owner":{"__rl":true,"value":"url_do_github","mode":"url"},"repository":{"__rl":true,"value":"n8n_bkp","mode":"list","cachedResultName":"n8n_bkp","cachedResultUrl":"https://github.com/armtexIA/n8n_bkp"},"filePath":"={{ $binary.data.fileName }}","binaryData":true,"commitMessage":"=backup-{{ $node['Set commit date'].json.commitDate }}"},"id":"e55129d8-70b4-4c1b-851f-22006cc95ecd","name":"Upload file [GITHUB]","type":"n8n-nodes-base.github","typeVersion":1,"position":[420,500],"webhookId":"8e4d0a81-31fa-4fe1-8077-db1fd8e3a5a6","credentials":{"githubApi":{"id":"EN8RdrPthxo5wicx","name":"GitHub account"}}},{"parameters":{"content":"## Setar hora e data\nEsses nodes setam a hora atual no formato `dd-MM-yyyy/H:mm`. Data e hora são utilizadas para dar o commit em atualizações no github exemplo: `backup-12-07-2023/14:18`.","height":339.42690909090965,"width":585.4045090909088},"id":"81bb0a4a-daf6-41fc-ad1b-aafbdf03075e","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1520,220]},{"parameters":{"content":"## Faz uma lista de arquivos existentes\nRetornar uma lista de arquivos existentes (backups) no repositório do GitHub. Os dados retornados por esses nós são usados pelo nó \"IF\" (mais adiante no fluxo de trabalho) para verificar se os arquivos de backup devem ser criados ou atualizados.","height":366.0444913259516,"width":389.89265454545443},"id":"9995b075-e203-4ffe-b513-420e176a8062","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-920,180]},{"parameters":{"content":"## Retrieve workflows\nPega todos os workflows no N8N","height":352.918087417239,"width":384.14708363636373},"id":"5f704ed1-8b50-4f14-8bb3-ee2b52f2909f","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-520,220]},{"parameters":{"content":"## Upload backup\nDivide arquivos JSON em lotes de 1, verifica se foram carregados no repositório antes. Se sim (verdadeiro), fazer o upload da nova versão do arquivo. Caso contrário (falso), criar o arquivo no repositório.","height":731.633426614796,"width":732.2653897437231},"id":"9bbd4662-3db7-4f71-a3c7-d46d4431c8ea","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-120,-40]},{"parameters":{"rule":{"interval":[{"field":"hours"}]}},"id":"edfe78eb-9ef4-4331-8f8a-e7c1f6a29098","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1660,380]}],"connections":{"Set date":{"main":[[{"node":"Format date","type":"main","index":0}]]},"Format date":{"main":[[{"node":"Set commit date","type":"main","index":0}]]},"Set commit date":{"main":[[{"node":"List files from repository [GITHUB]","type":"main","index":0}]]},"List files from repository [GITHUB]":{"main":[[{"node":"Combine file names [GITHUB]","type":"main","index":0}]]},"Combine file names [GITHUB]":{"main":[[{"node":"Retrieve workflows [N8N]","type":"main","index":0}]]},"Retrieve workflows [N8N]":{"main":[[{"node":"Move JSON to binary","type":"main","index":0}]]},"Move JSON to binary":{"main":[[{"node":"Split to single items","type":"main","index":0}]]},"Split to single items":{"main":[[{"node":"Check if file exists in repository","type":"main","index":0}]]},"Check if file exists in repository":{"main":[[{"node":"Update file [GITHUB]","type":"main","index":0}],[{"node":"Upload file [GITHUB]","type":"main","index":0}]]},"Update file [GITHUB]":{"main":[[{"node":"Split to single items","type":"main","index":0}]]},"Upload file [GITHUB]":{"main":[[{"node":"Split to single items","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Set date","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"c650187e-3dc3-4ea8-a724-010cdca194f3","triggerCount":0,"tags":[{"createdAt":"2025-06-08T19:46:11.123Z","updatedAt":"2025-06-08T19:46:11.123Z","id":"RS5Enyqjq1ACZGNy","name":"armtexFluxos"}]}